{% load static %}

<!-- LOOPS AND DISPLAYS PRODUCTS IN SHOPPING CART -->
<script>
    function createProducts(products) {
        var result = JSON.parse(localStorage.getItem("basket"))
        var many = JSON.parse(localStorage.getItem("amounts"))
        var holder = document.querySelectorAll(".products_holder")[0]

        products = safelyParseJSON(products)

        for (product in products) {

            if (products[product]['fields']['title'] in result) {
                title = products[product]['fields']['title']
                img = products[product]['fields']['image']
                price = products[product]['fields']['price']

                basket_display = (`
                        <!-- TR -->
                          <tr class="text-center">
                            <td class="product-remove"><a onclick="removeProduct('${ title }')"><span class="ion-ios-close"></span></a></td>

                            <td class="image-prod"><div class="img" style="background-image: url('{% static 'Images/Meals/${img}' %}');"></div></td>

                            <td class="product-name">
                                <h3>${title}</h3>
                            </td>

                            <td class="price">€${price}</td>

                            <td class="quantity">
                                <div class="input-group mb-3">
                                    <input type="number" name="quantity" class="quantity form-control input-number" value="${ many[title] }" min="1" max="12" onchange="changeAmount('${title}', '${price}', this.value)">
                                </div>
                              </td>

                            <td class="total_product">
                                €${currency(result[title])}
                            </td>
                          </tr>
                          <!-- END TR-->
                  `)

          holder.innerHTML += basket_display
          }
        }
    }

    function Create() {
        var holder = document.querySelectorAll(".products_holder")[0]
        holder.innerHTML = ''

        holder.innerHTML = ''
        createProducts('{{ bvdw|escapejs }}')
        createProducts('{{ products|escapejs }}')
    }

    function checkCodes(input_code) {
        codes = safelyParseJSON('{{ coupons|escapejs }}')
        for (code in codes) {
            if (codes[code]['fields']['code'] == input_code) {
                couponSuccess(codes[code]['fields']['discount'])
                return
            }
        }
        couponError()
    }
</script>
